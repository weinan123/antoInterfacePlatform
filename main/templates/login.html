{% extends 'basemain.html' %}
{% block title %}个人信息修改 {% endblock %}
{% block navbar %}
{% endblock %}
{% block content %}
<div class="col-md-4"></div>
<div class=" col-md-4  panel panel-default" style="margin-top: 150px;" >
    <div class="panel-body">
        <form class="form-horizontal" role="form">
        {% csrf_token %}
           <div class="form-group">
               <h3 style="text-align: center">登录</h3>
               <div class="col-sm-1"></div>
              <label  class="col-sm-4 control-label">登录名</label>
              <div class="col-sm-4">
                 <input type="text" class="form-control" name="username" v-model="username"
                    placeholder="请输入用户名">
              </div>
           </div>
           <div class="form-group">
               <div class="col-sm-1"></div>
              <label  class="col-sm-4 control-label">密码</label>
              <div class="col-sm-4">
                 <input type="password" class="form-control" name="password" v-model="password"
                    placeholder="请输入密码">
              </div>
           </div>
           <div class="form-group">
               <div class="col-sm-3"></div>
              <div class="col-sm-offset-2 col-sm-4">
                 <button @click="login()" type="button" class="btn btn-primary">登录</button>
                  <p style="color: red">{! login_error !}</p>
              </div>
           </div>
        </form>
    </div>
</div>
<div class="col-md-4"></div>
{% endblock %}
{% block vuejs %}
<script type="text/javascript">
var vm = new Vue({
    delimiters: ['{!', '!}'],
    el:'#app',
    data:{
        username :"",
        password:"",
        status:"",
        login_user:"",
        login_error:""
    },
    create(){
        this.setCookie("usename",this.username);
        localStorage.setItem("usename",this.username)
    },
    methods:{
        //设置cookie
            setCookie(cname, cvalue) {
                let path = '/';
                console.info(cname + "=" + cvalue );
                document.cookie = cname + "=" + cvalue+';path='+path;
                console.info(document.cookie);
            },
        login(){
            data_to_send = {
                username: this.username,
                password:this.password,
            };
            axios.post('/login/',data_to_send)
                .then(resp =>{
                        if (resp.data.status==="success"){
                            this.setCookie("usename",this.username);
                            console.log(resp.data);
                            this.status = resp.data.status;
                            this.login_user = resp.data.username;
                            window.location.href="/index/";
                        }else{
                            console.log(resp.data);
                            this.login_error = resp.data.message
                        }

                    }).catch(err=>{
                        console.log('请求失败:'+err.status+','+err.statusText);
                })
        }
    }
})
</script>
{% endblock %}
